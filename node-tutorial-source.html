<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>

    <!-- Navbar (sit on top) -->
	<div class="w3-top">
	  <div class="w3-bar w3-white w3-card" id="myNavbar">
	    <a href="index.html#home" class="w3-bar-item w3-button w3-wide">IAN HUTCHCRAFT</a>
	    <!-- Right-sided navbar links -->
	    <div class="w3-right w3-hide-small">
	      <a href="index.html#about" class="w3-bar-item w3-button"><i class="fa fa-user-o"></i> ABOUT</a>
	      <a href="index.html#work" class="w3-bar-item w3-button"><i class="fa fa-laptop"></i> WORK</a>
	      <div class="w3-dropdown-hover w3-hide-small">
		    <a href="index.html#examples"><button class="w3-button" title="Notifications"><i class="fa fa-keyboard-o"></i> EXAMPLES <i class="fa fa-caret-down"></i></button></a>     
		    <div class="w3-dropdown-content w3-card-4 w3-bar-block">
		      <a href="space-defense.html" class="w3-bar-item w3-button">Space Defense Force 9 Game</a>
		      <a href="button-clicks.html" class="w3-bar-item w3-button">Button Clicks Game</a>
		      <a href="button-clicks-source.html" class="w3-bar-item w3-button">Button Clicks Source</a>
		    </div>
		  </div>
		  <a href="index.html#projects" class="w3-bar-item w3-button"><i class="fa fa-mortar-board"></i> PROJECTS</a>
		  <a href="index.html#hobbies" class="w3-bar-item w3-button"><i class="fa fa-wrench"></i> HOBBIES</a>
	      <a href="index.html#contact" class="w3-bar-item w3-button"><i class="fa fa-envelope"></i> CONTACT</a>
	    </div>
	    <!-- Hide right-floated links on small screens and replace them with a menu icon -->
	
	    <a href="javascript:void(0)" class="w3-bar-item w3-button w3-right w3-hide-large w3-hide-medium" onclick="w3_open()">
	      <i class="fa fa-bars"></i>
	    </a>
	  </div>
	</div>
	
	<!-- Sidebar on small screens when clicking the menu icon -->
	<nav class="w3-sidebar w3-bar-block w3-black w3-card w3-animate-left w3-hide-medium w3-hide-large" style="display:none" id="mySidebar">
	  <a href="javascript:void(0)" onclick="w3_close()" class="w3-bar-item w3-button w3-large w3-padding-16">Close ×</a>
	  <a href="index.html#about" onclick="w3_close()" class="w3-bar-item w3-button">ABOUT</a>
	  <a href="index.html#work" onclick="w3_close()" class="w3-bar-item w3-button">WORK</a>
	  <a href="index.html#examples" onclick="w3_close()" class="w3-bar-item w3-button">EXAMPLES</a>
	  <a href="index.html#projects" onclick="w3_close()" class="w3-bar-item w3-button">PROJECTS</a>
	  <a href="index.html#hobbies" onclick="w3_close()" class="w3-bar-item w3-button">HOBBIES</a>
	  <a href="index.html#contact" onclick="w3_close()" class="w3-bar-item w3-button">CONTACT</a>
	</nav>
	
<div class="container  w3-grey">
  <div class="panel-group" id="accordion" style="padding-top:50px;">
   <h2 style="color:#ffffff;">Node.js/Express Source</h2>
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a data-toggle="collapse" data-parent="#accordion" href="#collapse1" onclick="w3CodeColor(highlightDivHTML)">Express index.jade Source Code</a>
        </h4>
      </div>
      <div id="collapse1" class="panel-collapse collapse">
    	<pre class="prettyprint">
extends layout

block content
  h1= title
  p Welcome to our test

  // Wrapper
  #wrapper

    // USER INFO
    #userInfo
      h2 User Info
      p
        strong Name:
        |  &lt;span id='userInfoName'&gt;&lt;/span&gt;
        br
        strong Age:
        |  &lt;span id='userInfoAge'&gt;&lt;/span&gt;
        br
        strong Gender:
        |  &lt;span id='userInfoGender'&gt;&lt;/span&gt;
        br
        strong Location:
        |  &lt;span id='userInfoLocation'&gt;&lt;/span&gt;
    // /USER INFO

    // USER LIST
    h2 User List
    #userList
      table
        thead
          th UserName
          th Email
          th Update
          th Delete
        tbody
    // /USER LIST
    
    // ADD USER
    h2 Add User
    #addUser
      fieldset
        input#inputUserName(type='text', placeholder='Username')
        input#inputUserEmail(type='text', placeholder='Email')
        br
        input#inputUserFullname(type='text', placeholder='Full Name')
        input#inputUserAge(type='text', placeholder='Age')
        br
        input#inputUserLocation(type='text', placeholder='Location')
        input#inputUserGender(type='text', placeholder='gender')
        br
        button#btnAddUser Add User
        button#btnUpdateUser Update User
    // /ADD USER
    
  // /WRAPPER
    	</pre>
      </div>
    </div>
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a data-toggle="collapse" data-parent="#accordion" href="#collapse2" onclick="w3CodeColor(highlightDivCSS)">users.js user router Source Code</a>
        </h4>
      </div>
      <div id="collapse2" class="panel-collapse collapse">
        <div class="panel-body" id="highlightDivJS">
			<pre class="prettyprint">
var express = require('express');
var router = express.Router();

/* GET userlist. */
router.get('/userlist', function(req, res){
	var db = req.db;
	var collection = db.get('userlist');
	
	collection.find({},{},function(e,docs){
		res.json(docs);
	});
});

/* POST to adduser. */
router.post('/adduser', function(req, res){
	console.log(req.body);
	var db = req.db;
	var collection = db.get('userlist');
	collection.insert(req.body, function(err, result){
		res.send((err === null) ? { msg: ''} : { msg: err });
	});
});

/* GET to getupdateuser. */
router.get('/getupdateuser/:id', function(req, res) {
  var db = req.db;
  var collection = db.get('userlist');
  var userToUpdate = req.params.id;
  collection.find({ '_id' : userToUpdate }, function(e, docs) {
	  res.json(docs);
  });
});

/* Update to updateuser. */
router.put('/updateuser', function(req, res) {
  var db = req.db;
  var collection = db.get('userlist');
  var userToUpdate = req.body._id;
  var updateData = req.body;
  
  delete updateData._id;
  
  collection.update({ '_id' : userToUpdate}, { $set: updateData}, function(err) {
    res.send((err === null) ? { msg: '' } : { msg:'error: ' + err });
  });
});

/* DELETE to deleteuser. */
router.delete('/deleteuser/:id', function(req, res) {
  var db = req.db;
  var collection = db.get('userlist');
  var userToDelete = req.params.id;
  collection.remove({ '_id' : userToDelete }, function(err) {
    res.send((err === null) ? { msg: '' } : { msg:'error: ' + err });
  });
});

module.exports = router;
			</pre>
		</div>
      </div>
    </div>
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a data-toggle="collapse" data-parent="#accordion" href="#collapse3" onclick="w3CodeColor(highlightDivJS)">global.js Javascript Source Code</a>
        </h4>
      </div>
      <div id="collapse3" class="panel-collapse collapse">
        <div class="panel-body" id="highlightDivJS">
			<pre class="prettyprint">
// Userlist data array for filling in info box
var userListData = [];

// DOM Ready =============================================================
$(document).ready(function() {

  // Populate the user table on initial page load
  populateTable();
  
  //Username link click
  $('#userList table tbody').on('click', 'td a.linkshowuser', showUserInfo);
  
  //Add User button click
  $('#btnAddUser').on('click', addUser);
  //Add User button click
  $('#btnUpdateUser').on('click', updateUser);
  
  //Update User link click
  $('#userList table tbody').on('click', 'td a.linkgetupdateuser', getUpdateUser);
  
  //Delete User link click
  $('#userList table tbody').on('click', 'td a.linkdeleteuser', deleteUser);

});

// Functions =============================================================

// Fill table with data
function populateTable() {

  // Empty content string
  var tableContent = '';

  // jQuery AJAX call for JSON
  $.getJSON( '/users/userlist', function( data ) {
	
    userListData = data;
    // For each item in our JSON, add a table row and cells to the content string
    $.each(data, function(){
      tableContent += '&lt;tr&gt;';
      tableContent += '&lt;td&gt;&lt;a href="#" class="linkshowuser" rel="' + this.username + '"&gt;' + this.username + '&lt;/a&gt;&lt;/td&gt;';
      tableContent += '&lt;td&gt;' + this.email + '&lt;/td&gt;';
      tableContent += '&lt;td&gt;&lt;a href="#" class="linkgetupdateuser" rel="' + this._id + '"&gt;Update&lt;/a&gt;&lt;/td&gt;';
      tableContent += '&lt;td&gt;&lt;a href="#" class="linkdeleteuser" rel="' + this._id + '"&gt;Delete&lt;/a&gt;&lt;/td&gt;';
      tableContent += '&lt;/tr&gt;';
    });

    // Inject the whole content string into our existing HTML table
    $('#userList table tbody').html(tableContent);
  });
};

// Show User Info
function showUserInfo(event){
	//Prevent Link from Firing
	event.preventDefault();
	
	// Retrieve username from link rel attribute
	var thisUserName = $(this).attr('rel');
	
	// Get Index of object based on id value
	var arrayPosition = userListData.map(function(arrayItem){return arrayItem.username;}).indexOf(thisUserName);
	
	// Get our User Object
	var thisUserObject = userListData[arrayPosition];

	//Populate Info Box
	$('#userInfoName').text(thisUserObject.fullname);
	$('#userInfoAge').text(thisUserObject.age);
	$('#userInfoGender').text(thisUserObject.gender);
	$('#userInfoLocation').text(thisUserObject.location);
};

//Add User
function addUser(event) {
	event.preventDefault();
	
	// Super basic validation - increase errorCount variable if any fields are blank
	var errorCount = 0;
	$('#addUser input').each(function(index, val) {
		if($(this).val() === '') { errorCount++; }
	});
	
	// Check and make sure errorCount's still at zero
	if(errorCount === 0) {
		
		// If it is, compile all user info into one object
		var newUser = {
		'username': $('#addUser fieldset input#inputUserName').val(),
		'email': $('#addUser fieldset input#inputUserEmail').val(),
		'fullname': $('#addUser fieldset input#inputUserFullname').val(),
		'age': $('#addUser fieldset input#inputUserAge').val(),
		'location': $('#addUser fieldset input#inputUserLocation').val(),
		'gender': $('#addUser fieldset input#inputUserGender').val()
		}
		
		 // Use AJAX to post the object to our adduser service
		 $.ajax({type: 'POST', data: newUser, url: '/users/adduser', dataType: 'JSON'}).done(function( response ) {
			// Check for successful (blank) response
			if (response.msg === '') {
				 // Clear the form inputs
				$('#addUser fieldset input').val('');
				
				// Update the table
				clearUserInfo()
				populateTable();
			} else {
				// If something goes wrong, alert the error message that our service returned
				alert('Error: ' + response.msg);
			}
		});
	} else {
		// If errorCount is more than 0, error out
		alert('Please fill in all fields');
		return false;
	}
};

//Get User To Update
function getUpdateUser(event) {
	//Prevent Link from Firing
	event.preventDefault();
	
	// Retrieve username from link rel attribute
	var thisUserId = $(this).attr('rel');
	
	// Get Index of object based on id value
	var arrayPosition = userListData.map(function(arrayItem){return arrayItem._id;}).indexOf(thisUserId);
	
	// Get our User Object
	var userToUpdate = userListData[arrayPosition];
	
	//Populate Info Box
	$('#inputUserName').val(userToUpdate.username);
	$('#inputUserEmail').val(userToUpdate.email);
	$('#inputUserFullname').val(userToUpdate.fullname);
	$('#inputUserAge').val(userToUpdate.age);
	$('#inputUserLocation').val(userToUpdate.location);
	$('#inputUserGender').val(userToUpdate.gender);
	
	$('#btnAddUser').prop("disabled",true);
	$('#btnUpdateUser').css('visibility', "visible");
	$('#btnUpdateUser').attr('value', thisUserId);
};

//Update User
function updateUser(event) {
	event.preventDefault();
	
	// Super basic validation - increase errorCount variable if any fields are blank
	var errorCount = 0;
	$('#addUser input').each(function(index, val) {
		if($(this).val() === '') { errorCount++; }
	});
	
	// Check and make sure errorCount's still at zero
	if(errorCount === 0) {
		
		// If it is, compile all user info into one object
		var updatedUser = {
			'_id': this.value,
			'username': $('#addUser fieldset input#inputUserName').val(),
			'email': $('#addUser fieldset input#inputUserEmail').val(),
			'fullname': $('#addUser fieldset input#inputUserFullname').val(),
			'age': $('#addUser fieldset input#inputUserAge').val(),
			'location': $('#addUser fieldset input#inputUserLocation').val(),
			'gender': $('#addUser fieldset input#inputUserGender').val()
		}
		
		// Use AJAX to post the object to our adduser service
		$.ajax({type: 'PUT', data: updatedUser, url: '/users/updateuser', dataType: 'JSON'}).done(function( response ) {
			// Check for successful (blank) response
			if (response.msg === '') {
				 // Clear the form inputs and update button properties
				$('#addUser fieldset input').val('');
				$('#btnAddUser').prop("disabled",false);
				$('#btnUpdateUser').css('visibility', "hidden");
				$('#btnUpdateUser').attr('value', '');
				
				// Update the table
				clearUserInfo();
				populateTable();
			} else {
				console.log('error');
				// If something goes wrong, alert the error message that our service returned
				alert('Error: ' + response.msg);
			}
		});
	} else {
		// If errorCount is more than 0, error out
		alert('Please fill in all fields');
		return false;
	}
};

//Delete User
function deleteUser(event) {
	//Prevent Link from Firing
	event.preventDefault();

	// Pop up a confirmation dialog
	var confirmation = confirm('Are you sure you want to delete this user?');
	
	// Check and make sure the user confirmed
	if (confirmation === true) {
		// If they did, do our delete
		$.ajax({type: 'DELETE',	url: '/users/deleteuser/' + $(this).attr('rel')}).done(function( response ) {
		
			// Check for a successful (blank) response
			if (response.msg === '') {
				clearUserInfo();
				$('#addUser fieldset input').val('');
				$('#btnAddUser').prop("disabled",false);
				$('#btnUpdateUser').css('visibility', "hidden");
				$('#btnUpdateUser').attr('value', '');
			} else {
				alert('Error: ' + response.msg);
			}
			
			// Update the table
			populateTable();
		
		});
	} else {
		// If they said no to the confirm, do nothing
		return false;
	}
};

function clearUserInfo(){
	//Populate Info Box
	$('#userInfoName').empty();
	$('#userInfoAge').empty();
	$('#userInfoGender').empty();
	$('#userInfoLocation').empty();
};
			</pre>
		</div>
      </div>
    </div>
  </div> 
  <p style="color:#ffffff;">Source syntax highlighting was done using google code-prettify.</p>
</div>
</body>
</html>